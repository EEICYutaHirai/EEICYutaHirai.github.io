<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles/patakara.css">
    <title>モバイル端末による口腔機能の評価・訓練の実現に向けた口腔機能の調査</title>
</head>

<body>
    <h1>
        「パ」の発音
    </h1>
    <p>
        以下の実験では，5秒間の間にできる限り多く「パ」と発音していただきます．
    </p>
    <p>
        以下の説明を読んでから，スタートボタンを押して実験を始めてください．
    </p>
    <ol>
        <li>鼻より下の範囲の口が映るようにカメラの位置を調整してください。スマートフォンを立てかけるなどして実験中にカメラの位置がずれないようにしてください．</li>
        <li>スタートボタンを押すと，3秒間のカウントダウンが始まります．スタートボタンを押して，待機してください．</li>
        <li>カウントダウンが0になると，5秒間の録画が開始されます．できる限りたくさん<strong>「パ」</strong>と発音してください．</li>
        <li>5秒間たつと録画が終了し，自動で次の実験ページに移動します．</li>
    </ol>
    <div class="camera">
        <video id="video" muted>Video stream not available.</video>
    </div><br>
    <button id="startbutton">スタート</button>
    <p id="description" style='display:none;'></p>
    <button id="upload" style="display:none;">動画をアップロードして次に進む</button><br>
    <!-- <div>
        <video id="test"></video>
    </div> -->
    <a href="./ta.html" id="next-page" style="display:none">次に進む</a>
    <p id="error-upload" style="display:none;">アップロードに失敗しました．責任者にお問い合わせください．</p>
    <p id="no-permission" style="display:none;">マイクとカメラの使用が許可されなかったようです．リロードして再度お試しください．</p>

</body>
<script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-storage.js"></script>

<script>
    function uploadVideo() {
        var firebaseConfig = {
            apiKey: "AIzaSyBoc4yB0ufBepHvS2IZqfRM2C4i3xtgAxQ",
            authDomain: "oralfrailexperiment-19fa7.firebaseapp.com",
            projectId: "oralfrailexperiment-19fa7",
            storageBucket: "oralfrailexperiment-19fa7.appspot.com",
            messagingSenderId: "550131966506",
            appId: "1:550131966506:web:31e8df4ba565a295ded953"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        storageRef = firebase.storage().ref();

        experimentId = window.location.search.slice(4);
        var uploadRef = storageRef.child(experimentId + '/pa.webm');
        var blob = new Blob(record_data, { type: 'video/webm' })
        uploadRef.put(blob).then(function (snapshot) {
            location.href = "./ta.html?id=" + String(experimentId);
        }).catch(function (e) {
            document.getElementById("error-upload").setAttribute('style', 'color:red;');
            console.log(e);
        });
    }
</script>
<script src="./scripts/patakara.js"></script>

</html>